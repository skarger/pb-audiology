<p class="pl-1 md:pl-3">Please submit the form below to send us a question or arrange an appointment.</p>

<p class="pl-1 md:pl-3">
Alternatively, you can call us at <a class="text-teal-darker" href="tel:<%= telephone %>"><%= telephone %></a></li>.
</p>

<%# We store the form data in a session cookie on submission. %>
<%# We do this in case the form submission fails because of invalid input or other server error. %>
<%# Then we can restore the input in the reloaded form, and display an error message. %>
<%# This approach imposes a maximum length on the input: The cookie must be <= 4096 bytes. %>
<%# See http://roda.jeremyevans.net/rdoc/classes/Roda/RodaPlugins/Sessions.html %>
<%# We declare generous maxlengths for the input fields, but leave room for %>
<%# the additional characters generated by the session cookie algorithm. %>
<%# If this length constraint becomes a problem we could gzip the cookie, but see caveats in Roda docs. %>
<%# Or we could store the input in a DB and simply use the session as a pointer to it. %>
<% max_length_full_name = 200 %>
<% max_length_email = 100 %>
<% max_length_phone = 100 %>
<% max_length_message = 3000 %>

<form id="contact-requests" action="/contact_requests" method="post">
    <div class="flex flex-col pt-4 pl-1 md:pl-3 w-5/6 sm:w-2/3 font-semibold">
        <% contact_success_message_visibility = "invisible" %>
        <% contact_request_result_message = "" %>
        <% if contact_request_result == "success" %>
            <% contact_success_message_visibility = "visible" %>
            <% contact_request_result_message = "Thank you for reaching out!" %>
        <% elsif contact_request_result == "failure" %>
            <% contact_success_message_visibility = "visible" %>
            <% contact_request_result_message = "Submission failed. Please check your input and try again." %>
        <% end %>

        <div class="flex justify-start mb-6 <%= contact_success_message_visibility %>">
            <%= contact_request_result_message %>
        </div>

        <div class="flex flex-col sm:flex-row mb-6">
            <label for="full_name" class="pr-4 flex-none w-1/4">Name</label>
            <input id="full_name" type="text" name="full_name" placeholder="Required" required maxlength="<%= max_length_full_name %>" value="<%= contact_request_full_name %>" class="border-2 border-grey-light rounded flex-grow">
        </div>

        <div class="flex flex-col sm:flex-row mb-6">
            <label for="email" class="pr-4 flex-none w-1/4">Email</label>
            <input id="email" type="email" name="email" placeholder="Required" required maxlength="<%= max_length_email %>" value="<%= contact_request_email %>" class="border-2 border-grey-light rounded flex-grow">
        </div>

        <div class="flex flex-col sm:flex-row mb-6">
            <label for="phone" class="pr-4 flex-none w-1/4">Phone</label>
            <input id="phone" type="tel" name="phone" placeholder="Required if requesting appoinment" maxlength="<%= max_length_phone %>" value="<%= contact_request_phone %>" class="border-2 border-grey-light rounded flex-grow">
        </div>

        <div class="flex flex-col mb-6">
            <label for="message">Message <span class="italic font-normal">(summary, we will follow up for more details)</span></label>
            <textarea id="message" name="message" placeholder="Required" rows="8" required maxlength="<%= max_length_message %>" class="border-2 border-grey-light rounded"><%= contact_request_message %></textarea>
        </div>

        <div class="flex justify-end mb-6">
            <% if contact_request_result == "success" %>
                <% disabled = "disabled" %>
                <% button_color = "bg-grey text-grey-darker" %>
            <% else %>
                <% disabled = "" %>
                <% button_color = "bg-teal-darker hover:text-orange-dark text-orange-lighter" %>
            <% end %>
            <input <%= disabled %> type="submit" value="Submit" class="w-1/3 sm:w-1/4 h-8 <%= button_color %> rounded">
        </div>

        <%# repeat result message at bottom %>
        <div class="flex justify-end mb-6 <%= contact_success_message_visibility %>">
            Message submitted
        </div>
    </div>
</form>
